# Dash Dashboard with Authentication

A production-ready Dash dashboard with user authentication, designed for deployment on Render's free tier.

## Features

- ✅ **User Authentication** - Register, login, logout with Flask-Login
- ✅ **Protected Routes** - Dashboard accessible only to logged-in users
- ✅ **Password Security** - Hashed passwords using Werkzeug
- ✅ **Database** - SQLite with SQLAlchemy ORM
- ✅ **Large File Support** - Loads GeoJSON files from GitHub (up to 200MB)
- ✅ **Bootstrap UI** - Modern, responsive design
- ✅ **Production Ready** - Proper error handling and logging

## Project Structure

```
my_dash_app/
├── app.py                 # Main application
├── auth.py                # Authentication logic
├── db.py                  # Database configuration
├── models.py              # User model
├── geojson_loader.py      # GeoJSON loader
├── requirements.txt       # Python dependencies
├── render.yaml            # Render deployment config
├── README.md             # This file
└── templates/
    ├── login.html        # Login page
    ├── register.html     # Registration page
    └── home.html         # Home page
```

## Local Development

### Prerequisites

- Python 3.9+
- Git

### Setup

1. **Clone the repository**
   ```bash
   git clone https://github.com/YOUR_USERNAME/YOUR_REPO.git
   cd YOUR_REPO
   ```

2. **Create virtual environment**
   ```bash
   python -m venv venv
   source venv/bin/activate  # On Windows: venv\Scripts\activate
   ```

3. **Install dependencies**
   ```bash
   pip install -r requirements.txt
   ```

4. **Set environment variables**
   ```bash
   export SECRET_KEY="your-secret-key-here"
   export GEOJSON_URL="https://raw.githubusercontent.com/YOUR_USERNAME/YOUR_REPO/main/data/your_file.geojson"
   ```

5. **Run the application**
   ```bash
   python app.py
   ```

6. **Access the app**
   - Open browser to `http://localhost:8050`
   - Register a new account
   - Login and access the dashboard at `http://localhost:8050/dash/`

## Deploying to Render

### Step 1: Prepare Your GitHub Repository

1. **Store your GeoJSON file**
   
   For files under 100MB, commit directly:
   ```bash
   git add data/your_file.geojson
   git commit -m "Add GeoJSON data"
   git push
   ```

   For files 100MB-200MB, use Git LFS:
   ```bash
   git lfs install
   git lfs track "*.geojson"
   git add .gitattributes
   git add data/your_file.geojson
   git commit -m "Add large GeoJSON with LFS"
   git push
   ```

2. **Update the GeoJSON URL in `render.yaml`**
   ```yaml
   - key: GEOJSON_URL
     value: https://raw.githubusercontent.com/YOUR_USERNAME/YOUR_REPO/main/data/your_file.geojson
   ```

### Step 2: Deploy on Render

1. **Go to [Render.com](https://render.com) and sign up/login**

2. **Create a new Web Service**
   - Click "New +" → "Web Service"
   - Connect your GitHub repository
   - Render will auto-detect `render.yaml`

3. **Configure (if not using render.yaml)**
   - **Name**: dash-login-app
   - **Environment**: Python 3
   - **Build Command**: `pip install -r requirements.txt`
   - **Start Command**: `gunicorn app:server --bind 0.0.0.0:$PORT --workers 2 --timeout 120`

4. **Set Environment Variables**
   - `SECRET_KEY`: (Auto-generated by render.yaml, or set manually)
   - `GEOJSON_URL`: Your GitHub raw file URL

5. **Deploy**
   - Click "Create Web Service"
   - Wait 5-10 minutes for deployment
   - Access your app at `https://your-app-name.onrender.com`

## Important Notes

### Memory Management (Free Tier: 512MB RAM)

- Loading a 200MB GeoJSON file will use ~300-400MB in memory after JSON parsing
- Monitor your app's memory usage in Render dashboard
- Consider optimizing your GeoJSON:
  - Simplify geometries
  - Remove unnecessary properties
  - Use TopoJSON format (smaller file size)

### GitHub File Limits

- **Regular Git**: 100MB per file limit
- **Git LFS**: 2GB per file limit (1GB storage on free tier)
- For 120-200MB files, Git LFS is **required**

### Alternative File Hosting

If GitHub doesn't work well for your large files, consider:
- **GitHub Releases** (more reliable for large files)
- **Cloudflare R2** (free tier: 10GB storage)
- **AWS S3** (with public URL)

## Security Best Practices

1. **Never commit SECRET_KEY to Git**
   - Use environment variables
   - Let Render generate it automatically

2. **Use strong passwords**
   - Minimum 6 characters enforced
   - Consider adding more validation

3. **HTTPS Only**
   - Render provides free HTTPS
   - All traffic is encrypted

## Troubleshooting

### "Failed to load GeoJSON"
- Check if GitHub URL is accessible
- Verify file is pushed to repository
- For Git LFS files, ensure LFS is installed

### "Application out of memory"
- Your GeoJSON file is too large for 512MB RAM
- Simplify the GeoJSON or upgrade Render plan
- Consider loading data on-demand instead of at startup

### "Database is locked"
- SQLite can have issues with concurrent writes
- For production with multiple users, consider upgrading to PostgreSQL

### "Cannot access /dash/ route"
- Ensure you're logged in first
- Check browser console for errors
- Verify SECRET_KEY is set

## Monitoring Users

To see registered users, you can:

1. **Access the database locally**
   ```bash
   sqlite3 users.db
   SELECT * FROM users;
   ```

2. **Add an admin panel** (future enhancement)
   - Create `/admin` route with user list
   - Add user management features

## Future Enhancements

- [ ] Admin dashboard to manage users
- [ ] Password reset functionality
- [ ] Email verification
- [ ] User roles and permissions
- [ ] PostgreSQL for production database
- [ ] Better GeoJSON visualization
- [ ] Caching for improved performance

## License

MIT License - feel free to use and modify as needed.

## Support

For issues or questions:
1. Check the troubleshooting section
2. Review Render logs: Dashboard → Logs
3. Open an issue on GitHub